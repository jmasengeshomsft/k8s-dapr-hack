name: 0.1.$(Rev:r)
trigger:
  branches:
    include:
    - main
  paths:
    include:
    - Infrastructure/bicep/*
    
variables:
  vmImageName: 'ubuntu-latest'
  azureServiceConnection: 'Demo Account'

stages:
  - stage: AKS
    displayName: AKS Deploy
    jobs:
    - template: azure-pipelines-core-deploy-template.yml
      parameters:
        appName: 'rutzsco-dapr-demo'
        environment: 'aks'
        azureSubscription: $(azureSubscription)
        location: 'eastus'
        resourceGroupName: rutzsco-dapr-demo-aks'

  - stage: ACA
    displayName: ACA Deploy
    jobs:
    - template: azure-pipelines-core-deploy-template.yml
      parameters:
        appName: 'rutzsco-dapr-demo'
        environment: 'aca'
        azureSubscription: $(azureSubscription)
        location: 'eastus'
        resourceGroupName: 'rutzsco-dapr-demo-aca'
      
      